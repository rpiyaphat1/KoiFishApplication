<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ | Koi Monitor</title>
    <style>
        /* Base and Theme CSS */
        :root {
            --background-color: #ffffff;
            --text-color: #000000;
            --card-bg: #f8f8f8;
            --btn-primary: #007bff;
            --btn-danger: #dc3545;
            --btn-save: #28a745;
        }

        body.dark-theme {
            --background-color: #121212;
            --text-color: #e0e0e0;
            --card-bg: #1e1e1e;
            --btn-primary: #4da6ff;
            --btn-danger: #ef4444;
            --btn-save: #2ecc71;
        }

        /* Global Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        .app-container {
            width: 100%;
            max-width: 400px;
            min-height: 100vh;
            background-color: var(--background-color);
            position: relative;
        }

        .top-fixed-controls {
            position: absolute;
            top: 15px;
            width: 90%;
            display: flex;
            justify-content: space-between;
            z-index: 10;
        }

        .lang-toggle-button {
            padding: 8px 12px;
            background-color: #f0f0f0;
            color: #343a40;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        body.dark-theme .lang-toggle-button {
            background-color: #333;
            color: #f0f0f0;
            border-color: #555;
        }

        /* Theme Toggle Switch styles (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô ‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå/‡∏û‡∏£‡∏∞‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå) */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 25px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ffc107;
            /* ‡∏™‡∏µ‡∏™‡∏ß‡πà‡∏≤‡∏á: ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á */
            transition: .4s;
            border-radius: 25px;
        }

        /* ‡∏ò‡∏µ‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á: ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏° (‡πÉ‡∏ä‡πâ :before) ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏°‡∏µ‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå */
        .slider:before {
            position: absolute;
            content: "";
            height: 17px;
            width: 17px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            /* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå ‚òÄÔ∏è (Unicode) */
            content: "\2600";
            font-size: 16px;
            color: #ffc107;
            /* ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏ó‡∏≠‡∏á */
            text-shadow: 0 0 2px rgba(0, 0, 0, 0.2);
        }

        /* ‡∏ò‡∏µ‡∏°‡∏°‡∏∑‡∏î: ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏° */
        input:checked+.slider {
            background-color: #2c3e50;
        }

        /* ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Check (Dark Mode): ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏°‡πÑ‡∏õ‡∏Ç‡∏ß‡∏≤ ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏£‡∏∞‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå */
        input:checked+.slider:before {
            transform: translateX(25px);
            background-color: #2c3e50;
            /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå */
            color: white;
            /* ‡∏™‡∏µ‡∏û‡∏£‡∏∞‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå */
            content: "\1F319";
            /* Unicode: Full Moon Symbol üåô */
            font-size: 14px;
            text-shadow: none;
        }

        /* User Info Card */
        .user-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0 0;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            background-color: #ccc;
            border: 3px solid var(--btn-primary);
            cursor: pointer;
        }

        /* Main content wrapper padding reduced */
        .main-settings-wrapper {
            padding: 90px 15px 70px 15px;
            /* 90px clearance from the top */
        }

        /* Form Inputs */
        .setting-section {
            background-color: var(--card-bg);
            padding: 20px;
            margin: 15px 0 0 0;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .input-label {
            display: block;
            font-size: 0.9em;
            margin-top: 15px;
            margin-bottom: 5px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .input-field {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        .non-editable {
            background-color: #aaa3;
            border-style: dashed;
        }

        /* Logout Button */
        #btnLogout {
            width: 100%;
            padding: 15px;
            margin-top: 30px;
            background-color: var(--btn-danger);
            color: white;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 400px;
            background-color: var(--card-bg);
            border-top: 1px solid #ccc;
            display: flex;
            justify-content: space-around;
            padding: 5px 0;
        }

        .nav-item {
            flex-grow: 1;
            text-align: center;
            color: #6c757d;
            font-size: 0.8em;
            padding: 10px 0;
            text-decoration: none;
        }

        .nav-item.active {
            color: var(--btn-primary);
        }

        .nav-item svg {
            width: 24px;
            height: 24px;
            display: block;
            margin: 0 auto 3px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }

        /* Modal Styles */
        .modal {
            /* ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô none ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            /* ‡πÉ‡∏ä‡πâ flex/justify/align ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ JS */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* *** FIX: ADJUSTED MODAL SIZE AND HEIGHT FOR CONFIRMATION MODALS *** */
        .modal-content {
            background-color: var(--card-bg);
            color: var(--text-color);
            /* FIX: ‡∏¢‡∏Å Modal ‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏≠‡∏µ‡∏Å (‡∏•‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á) */
            margin: 30% auto;
            padding: 20px;
            /* Padding ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å */
            border-radius: 10px;
            width: 70%;
            /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÅ‡∏Ñ‡∏ö */
            max-width: 280px;
            /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î */
            text-align: center;
        }

        /* *** END MODAL SIZE ADJUSTMENT *** */


        .modal-button {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            margin: 5px;
            border: none;
            width: 100%;
            display: block;
        }

        /* FIX: ‡∏õ‡∏£‡∏±‡∏ö spacing ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Logout Modal ‡πÉ‡∏´‡πâ‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î (‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á) */
        #logoutModal h4 {
            margin-bottom: 10px !important;
            /* ‡∏•‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ï‡πâ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ */
        }

        #logoutModal p {
            /* FIX: ‡∏•‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏£‡∏Å (‡∏à‡∏≤‡∏Å 15px ‡πÄ‡∏õ‡πá‡∏ô 10px) */
            margin-bottom: 10px !important;
            font-size: 0.9em;
        }

        #logoutModal button {
            margin: 8px auto;
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏° margin ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏° (8px ‡∏ö‡∏ô-‡∏•‡πà‡∏≤‡∏á) */
            padding: 12px 20px;
            /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡∏´‡∏ô‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô */
        }
    </style>
</head>

<body>
    <div class="app-container">

        <div class="top-fixed-controls">
            <div class="theme-toggle">
                <label class="toggle-switch">
                    <input type="checkbox" id="theme-toggle-checkbox">
                    <span class="slider"></span>
                </label>
            </div>
            <button id="lang-toggle-button" class="lang-toggle-button" onclick="toggleLanguage()">
                EN
            </button>
        </div>

        <div id="mainSettingsContent" class="main-settings-wrapper">
            <div class="user-card" id="profileSummaryCard" onclick="toggleEditMode(true)">
                <img id="profileAvatar" src="" class="avatar" alt="Profile">
                <div>
                    <div id="usernameDisplay" style="font-weight: bold; font-size: 1.1em;">A</div>
                    <div id="statusDisplay" style="font-size: 0.8em; color:#999;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</div>
                </div>
            </div>

            <input type="file" id="avatarFileInput" accept="image/*" style="display:none;">

            <div id="accountEditContainer" style="display:none;">

                <h3 id="settingsTitle" style="font-weight: bold; margin-bottom: 5px; margin-top: 20px;">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
                </h3>

                <div class="setting-section" style="padding:15px; text-align: center;">
                    <h4 id="photoControlTitle"
                        style="font-weight: bold; font-size: 1em; opacity: 0.9; margin-bottom: 10px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
                    </h4>

                    <img id="editAvatarPreview" src="" class="avatar"
                        style="width: 80px; height: 80px; margin: 0 auto 15px; display: block; border: 4px solid var(--btn-primary);"
                        alt="Edit Preview">

                    <div id="editControls" style="display: flex; justify-content: center; gap: 10px;">
                        <button class="modal-button" style="background-color: var(--btn-primary); color: white;"
                            onclick="changeProfilePhoto()" id="btnChangePhoto">
                            ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ
                        </button>
                        <button class="modal-button" style="background-color: #dc3545; color: white;"
                            onclick="removeProfilePhoto()" id="btnRemovePhoto">
                            ‡∏•‡∏ö‡∏£‡∏π‡∏õ
                        </button>
                    </div>
                </div>

                <form id="accountForm" class="setting-section" onsubmit="saveAccountChanges(event)">

                    <label class="input-label" id="labelDisplayName">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á (Display Name)</label>
                    <input id="displayNameInput" class="input-field" type="text" required>

                    <label class="input-label" id="labelUsername">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)</label>
                    <input id="usernameInput" class="input-field non-editable" type="text" disabled>

                    <label class="input-label" id="labelGmail">Gmail</label>
                    <input id="gmailInput" class="input-field" type="email" required>

                    <h4 id="passwordTitle"
                        style="font-weight: bold; margin-top: 30px; margin-bottom: 5px; font-size: 1em; opacity: 0.9;">
                        ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)</h4>

                    <label class="input-label" id="labelNewPass">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                    <input id="newPassInput" class="input-field" type="password">

                    <label class="input-label" id="labelConfirmPass">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                    <input id="confirmPassInput" class="input-field" type="password">

                    <button type="submit" class="modal-button"
                        style="background-color: #28a745; color: white; margin-top: 25px; width: 100%;"
                        id="btnSaveChanges">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</button>
                </form>

                <button class="modal-button"
                    style="background-color: #6c757d; color: white; margin-top: 15px; width: 100%;"
                    onclick="toggleEditMode(false)" id="btnDoneEditing">
                    ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                </button>
            </div>


            <button id="btnLogout" onclick="openLogoutModal()">
                ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
            </button>
        </div>

        <nav class="bottom-nav">
            <a href="main.html" class="nav-item" id="nav-home">
                <svg viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 0 0 1-2-2z" />
                    <polyline points="9 22 9 12 15 12 15 22" />
                </svg>
                <span class="label">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
            </a>
            <a href="settings.html" class="nav-item active" id="nav-settings">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12.22 2h-.44C11.19 2 11 2.19 11 2.44V4h2V2.44C13 2.19 12.81 2 12.56 2zM4.44 5L5 5.56L4.44 6L4 5.56L4.44 5zM20 5l.56.56L20.56 6L21 5.56L20 5zM4 12c0-4.42 3.58-8 8-8s8 3.58 8 8z" />
                </svg>
                <span class="label">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
            </a>
        </nav>
    </div>

    <div id="logoutModal" class="modal">
        <div class="modal-content">
            <h4 id="modalTitle" style="margin-bottom: 10px;">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h4>
            <p id="modalDesc" style="margin-bottom: 10px; font-size: 0.9em;">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?</p>
            <button class="modal-button" style="background-color: #6c757d; color: white; margin-top: 5px;"
                onclick="closeLogoutModal()" id="btnCancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="modal-button" style="background-color: var(--btn-danger); color: white;"
                onclick="confirmLogout()" id="btnConfirm">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>

    <script>
        // --- MOCK STORAGE KEYS ---
        const USER_DATA_KEY = 'koi_user_data';
        const DEFAULT_AVATAR = "anonymous.png";
        let mockUserData = { displayName: 'User A (Mock)', gmail: 'a@koi.com', avatar: DEFAULT_AVATAR };


        // --- CONTENT MAPS ---
        const langContent = {
            'th': {
                pageTitle: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ | Koi Monitor', navHome: '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å', navSettings: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤', username: 'A', status: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô', btnLogout: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö', settingsTitle: '‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ', passwordTitle: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô', photoControlTitle: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå',
                modalTitle: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö', modalDesc: '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?', btnCancel: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å', btnConfirm: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
                labelDisplayName: '‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á (Display Name)', labelUsername: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)', labelGmail: 'Gmail', labelNewPass: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà', labelConfirmPass: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà',
                btnSaveChanges: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á', btnChangePhoto: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ', btnRemovePhoto: '‡∏•‡∏ö‡∏£‡∏π‡∏õ',
                btnDoneEditing: '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
                alertSaved: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', alertPassMatch: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô', alertPassChanged: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', alertMissingInput: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'
            },
            'en': {
                pageTitle: 'Settings | Koi Monitor', navHome: 'Home', navSettings: 'Settings', username: 'A', status: 'Status: Logged In', btnLogout: 'Log Out', settingsTitle: 'Account Settings', passwordTitle: 'Change Password', photoControlTitle: 'Manage Profile Photo',
                modalTitle: 'Confirm Logout', modalDesc: 'Are you sure you want to sign out?', btnCancel: 'Cancel', btnConfirm: 'Log Out',
                labelDisplayName: 'Display Name', labelUsername: 'Username', labelGmail: 'Gmail', labelNewPass: 'New Password', labelConfirmPass: 'Confirm New Password',
                btnSaveChanges: 'Save Changes', btnChangePhoto: 'Change Photo', btnRemovePhoto: 'Remove Photo',
                btnDoneEditing: 'Done',
                alertSaved: 'Account data saved!', alertPassMatch: 'Passwords do not match.', alertPassChanged: 'Password changed successfully!', alertMissingInput: 'Please fill in all fields.'
            }
        };

        // --- Utility Functions ---
        function getLang() { return localStorage.getItem('lang') || 'th'; }

        function loadMockData() {
            try {
                const raw = localStorage.getItem(USER_DATA_KEY);
                if (raw) {
                    const data = JSON.parse(raw);
                    mockUserData.displayName = data.displayName || mockUserData.displayName;
                    mockUserData.gmail = data.gmail || data.gmail;
                    mockUserData.avatar = data.avatar || DEFAULT_AVATAR;
                }
            } catch (e) {
                console.error("Error loading user data:", e);
            }
        }

        function saveMockData() {
            localStorage.setItem(USER_DATA_KEY, JSON.stringify(mockUserData));
        }

        // --- Account Form Handlers ---

        function saveAccountChanges(e) {
            e.preventDefault();
            const lang = getLang();
            const content = langContent[lang];

            const newName = document.getElementById('displayNameInput').value.trim();
            const newGmail = document.getElementById('gmailInput').value.trim();
            const newPass = document.getElementById('newPassInput').value;
            const confirmPass = document.getElementById('confirmPassInput').value;

            // 1. Validate Account Details
            if (!newName || !newGmail) {
                alert(content.alertMissingInput);
                return;
            }

            let isPasswordChange = false;

            // 2. Validate Password Change (Only if fields are filled)
            if (newPass || confirmPass) {
                isPasswordChange = true;
                if (newPass !== confirmPass) {
                    alert(content.alertPassMatch);
                    document.getElementById('confirmPassInput').value = '';
                    return;
                }
                if (newPass.length < 6) {
                    alert(lang === 'th' ? '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£' : 'Password must be at least 6 characters.');
                    return;
                }
            }

            // 3. Save Data (Mockup)
            mockUserData.displayName = newName;
            mockUserData.gmail = newGmail;
            saveMockData();

            // 4. Feedback and UI Reset
            // Alert ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß

            toggleEditMode(false); // Close edit mode after saving
            updateView(); // Re-render summary card
        }

        // --- Profile Photo Logic ---
        function changeProfilePhoto() {
            // Clicks the hidden file input to trigger the file dialog
            document.getElementById('avatarFileInput').click();
        }

        function removeProfilePhoto() {
            const lang = getLang();
            mockUserData.avatar = DEFAULT_AVATAR; // Revert to anonymous.png
            saveMockData();
            // Alert ‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß
            updateView();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                mockUserData.avatar = e.target.result; // Save Base64 data
                saveMockData();
                updateView(); // Re-render with new avatar
            };
            reader.readAsDataURL(file);
        }


        // --- UI Rendering Logic ---
        function updateText(lang) {
            const content = langContent[lang];

            // General UI
            document.getElementById('page-title').textContent = content.pageTitle;
            document.getElementById('nav-home').querySelector('.label').textContent = content.navHome;
            document.getElementById('nav-settings').querySelector('.label').textContent = content.navSettings;
            document.getElementById('lang-toggle-button').textContent = getLang().toUpperCase() === 'TH' ? 'EN' : 'TH';
            document.getElementById('btnLogout').textContent = content.btnLogout;
            document.getElementById('statusDisplay').textContent = content.status;

            // Account Form Labels
            document.getElementById('settingsTitle').textContent = content.settingsTitle;
            document.getElementById('passwordTitle').textContent = content.passwordTitle;
            document.getElementById('labelDisplayName').textContent = content.labelDisplayName;
            document.getElementById('labelUsername').textContent = content.labelUsername;
            document.getElementById('labelGmail').textContent = content.labelGmail;
            document.getElementById('labelNewPass').textContent = content.labelNewPass;
            document.getElementById('labelConfirmPass').textContent = content.labelConfirmPass;
            document.getElementById('btnSaveChanges').textContent = content.btnSaveChanges;
            document.getElementById('photoControlTitle').textContent = content.photoControlTitle;
            document.getElementById('btnChangePhoto').textContent = content.btnChangePhoto;
            document.getElementById('btnRemovePhoto').textContent = content.btnRemovePhoto;

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
            const btnDone = document.getElementById('btnDoneEditing');
            if (btnDone) btnDone.textContent = content.btnDoneEditing;

            // Modal Text (Logout Modal)
            document.getElementById('modalTitle').textContent = content.modalTitle;
            document.getElementById('modalDesc').textContent = content.modalDesc;
            document.getElementById('btnCancel').textContent = content.btnCancel;
            document.getElementById('btnConfirm').textContent = content.btnConfirm;
        }

        function renderAccountData() {
            // Load and render data into form fields
            document.getElementById('displayNameInput').value = mockUserData.displayName;
            document.getElementById('gmailInput').value = mockUserData.gmail;
            document.getElementById('usernameInput').value = langContent[getLang()].username; // Always 'A' (mock)

            // Display Summary Card (Name and Avatar)
            document.getElementById('usernameDisplay').textContent = mockUserData.displayName;
            document.getElementById('profileAvatar').src = mockUserData.avatar;

            // Display Avatar in Edit Section Preview
            const editPreview = document.getElementById('editAvatarPreview');
            if (editPreview) editPreview.src = mockUserData.avatar;
        }

        // --- View Control ---

        function toggleEditMode(shouldOpen) {
            const editContainer = document.getElementById('accountEditContainer');
            const summaryCard = document.getElementById('profileSummaryCard');
            const logoutBtn = document.getElementById('btnLogout');

            if (shouldOpen) {
                // Enter Edit Mode
                renderAccountData();
                editContainer.style.display = 'block';
                summaryCard.style.display = 'none';
                logoutBtn.style.display = 'none';
            } else {
                // Exit Edit Mode (Done button clicked)
                editContainer.style.display = 'none';
                summaryCard.style.display = 'flex'; // Show summary card
                logoutBtn.style.display = 'block';
            }
        }


        // --- Theme/Language/Initial Functions ---
        const themeToggle = document.getElementById('theme-toggle-checkbox');

        themeToggle.addEventListener("change", function () {
            document.body.classList.toggle("dark-theme", this.checked);
            localStorage.setItem("theme", this.checked ? "dark" : "light");
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å updateView() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏©‡∏≤, ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            updateView();
        });

        function toggleLanguage() {
            let newLang = (getLang() === 'th') ? 'en' : 'th';
            localStorage.setItem('lang', newLang);
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å updateView() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏©‡∏≤, ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            updateView();
        }

        function applyThemeAndLangOnLoad() {
            // Load Theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                themeToggle.checked = true;
            } else {
                document.body.classList.remove('dark-theme');
                themeToggle.checked = false;
            }
            // Note: updateView() handles calling updateText() and renderAccountData()
        }

        function updateView() {
            loadMockData(); // Load data first (handles checking for DEFAULT_AVATAR)
            applyThemeAndLangOnLoad();
            updateText(getLang());
            renderAccountData(); // Render loaded data
        }

        // --- Logout Modal Logic ---
        function openLogoutModal() {
            updateText(getLang());
            // ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô display ‡∏à‡∏≤‡∏Å none ‡πÄ‡∏õ‡πá‡∏ô flex
            document.getElementById('logoutModal').style.display = 'flex';
        }

        function closeLogoutModal() {
            // ‡∏õ‡∏¥‡∏î Modal ‡πÇ‡∏î‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô display ‡πÄ‡∏õ‡πá‡∏ô none
            document.getElementById('logoutModal').style.display = 'none';
        }

        function confirmLogout() {
            // Clear storage and redirect
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('camCount');
            // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠ Logout
            localStorage.removeItem(USER_DATA_KEY);

            window.location.href = 'index.html?v=' + Date.now(); // *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà index.html ***
        }


        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('isLoggedIn') !== 'true') {
                window.location.href = 'index.html?v=' + Date.now(); // *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà index.html ***
                return;
            }

            // Set initial view state: show summary card, hide edit container
            document.getElementById('accountEditContainer').style.display = 'none';
            document.getElementById('profileSummaryCard').style.display = 'flex';
            document.getElementById('btnLogout').style.display = 'block';

            // ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Modal ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô none ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÅ‡∏£‡∏Å
            document.getElementById('logoutModal').style.display = 'none';


            updateView();

            // Event Listeners
            document.getElementById('profileSummaryCard').addEventListener('click', () => toggleEditMode(true)); // Click card to EDIT
            document.getElementById('accountForm').addEventListener('submit', saveAccountChanges);
            document.getElementById('avatarFileInput').addEventListener('change', handleFileSelect); // Handle file selection

            window.onclick = function (event) {
                // ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å Modal
                if (event.target == document.getElementById('logoutModal')) {
                    closeLogoutModal();
                }
            }
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏†‡∏≤‡∏©‡∏≤/‡∏ò‡∏µ‡∏°/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô
        window.addEventListener('storage', (event) => {
            if (event.key === 'lang' || event.key === 'theme' || event.key === USER_DATA_KEY) {
                updateView();
            }
        });
    </script>
</body>

</html>